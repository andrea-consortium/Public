# Python data upload script

A script to automatically upload files to a workspace. The script can be used in an automated flow or called directly from commandline or shortcut.

## Requirements

Python3 (tested on 3.9 and 3.10)

## How to use

Copy the python script to a local directory.
On linux use chmod to make it executable:

    chmod +x upload.py


To start upload, run the script via the command line

Linux:

    ./upload.py [arguments]

Windows:

    python [path-to]upload.py [arguments]
 
## Commandline arguments
Arguments can be supplied via the command line or inserted directly into the script (lines 15-20).
The following parameters are expected to be supplied via command line or the script:

### --workspace-name / workspace_name  
name of the workspace to upload to, e.g. dws-001-test  

### --subscription-apikey / subscription_apikey  
subscription key (can be requested via anDREa helpdesk)  

### --workspace-apikey / workspace_apikey  
api key for the subscription (should match workspace name). Can be generated by any authorised workspace user by going to your workspace on mydre.org and going to cog button at the top-right and selecting 'Api access' menu  

### --pause / pause
Makes the script pause at the end so any errors can be examined.

the following parameters are generally not needed as the defaults in the script should be sufficient:

### --block-size / block_size  
the default size of blockblobs when uploaded - generally, 4Mb is optimal. The script does not validate block size, it will fail during the first upload of a block if an invalid size is set.  

### --single-upload-size / single_upload_size  
the largest size file that will be uploaded as one block. Usually it is faster to upload a file in one go, but there are limits to how big such files are allowed to be. Defaults to 8Mb  

### --max-concurrency / max_concurrency   
the maximum amount of concurrent uploads. Usually setting this higher will increase upload speeds, though other factors influence this by a lot. Higher values will especially increase upload speeds when many small files are uploaded but may choke your connections at some point. Setting this too hight might incur overhead costs or throttle limits. A number around 5-20 is usually ok.  

### --api / api  
the url of the api used to manage upload containers. Generally this url is fixed.  


All remaining arguments are considered to be either files or folders to be uploaded. Individual files will be uploaded to the root of the upload container (e.g. /myfile1.txt), duplicates will overwrite each other. If you select a folder to be uploaded, all files within will be uploaded using the entire folder structure.  
You can specify many different files and/or folders in one upload.  

## Cancel

To cancel, hit ctr+c. the script will cancel current uploads and cancel (delete) the upload container. if you stop the script without giving it time to delete the container, the container (with existing data) will remain

## Shortcut windows

For windows, you can create a shortcut to the upload script (richtclick -> create shortcut) and add 'python' before the path to the script to automatically execute it, e.g.

    target: python "C:\users\user1\scripts\upload.py"
    start in: (doesnt matter)

Optionally, you can add required parameters to the target (if you don't add them to the script itself as described above), like so:

    target: python "C:\users\user1\scripts\upload.py" --workspace-name dws-001-test --workspace-apikey a270859a-8ee8-4e6a-b4aa-346587afe526 --subscription-apikey 977a9bdc44984744841f636c64752bf7
    start in: (doesnt matter)

Now, you can drag-drop files and folders onto the shortcut to start uploading them directly to your workspace.
If you place this shortcut in the sendto folder (on windows 10 this is %appdata%\Microsoft\Windows\SendTo), the shortcut will appear in the sendto context menu of windows explorer.
